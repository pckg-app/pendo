(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{115:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"c-pckg-htmlbuilder-dropzone",class:t.stateClass,attrs:{id:t.id}},[t.iconClass?i("div",{staticClass:"as-table",style:{minHeight:t.minHeight}},[i("div",{staticClass:"s-icon text-center"},[i("i",{staticClass:"__state-icon fa-fw",class:t.iconClass})]),i("div",{staticClass:"s-text"},["uploading"==t.state&&t.progress>0?i("span",{staticClass:"__percentage-progress"},[t._v(t._s(t.progress)+"%")]):t._e(),t._v(" "+t._s(t.infoText)+" ")]),t.state&&-1!=["uploading","drag","success"].indexOf(t.state)?t._e():i("div",{staticClass:"s-action text-right"},[i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openSelection(e)}}},[t._v("Upload new")])])]):t.myCurrent?i("div",{staticClass:"as-table",style:{minHeight:t.minHeight}},[t.preview&&!t.iconClass?i("div",{staticClass:"s-img"},[i("a",{directives:[{name:"popup-image",rawName:"v-popup-image"}],staticClass:"__img-link",attrs:{href:t.cdn(t.myCurrent)}},[i("img",{staticClass:"__img",attrs:{src:t.cdn(t.myCurrent)}})])]):t._e(),i("div",{staticClass:"s-text"},[t._v(" "+t._s(t.infoText)+" ")]),i("div",{staticClass:"s-action text-left"},[i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openSelection(e)}}},[t._v("Re-upload")]),t._v(" "),i("br"),i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.deleteFile(e)}}},[t._v("Delete")])])]):t._e(),i("div",{ref:"upload",staticClass:"hidden",attrs:{type:"file"}}),i("div",{staticClass:"hidden",attrs:{id:t.id+"-previews"}})])};s._withStripped=!0;i(97),i(98),i(102),i(103),i(96),i(106),i(112);var r=i(113),n=i.n(r),a={name:"pckg-htmlbuilder-dropzone",mixins:[pckgCdn],props:{current:{type:String,default:""},prev:{type:String,default:""},url:{type:String,default:""},params:{type:Object,default:function(){return{}}},id:{type:String,default:""},value:{type:String,default:""},accept:{default:null},options:{default:function(){return{maxSize:2}}},icon:{default:"image"},preview:{default:!0}},data:function(){return{original:null,_dropzone:null,_previewTemplate:null,myCurrent:this.current,state:null,hover:!1,progress:0,myOptions:this.options,minHeight:"auto"}},watch:{current:function(t){this.myCurrent=t},url:function(t,e){this.initDropzone()},params:function(t,e){this.initDropzone()}},computed:{stateClass:function(){return"error"===this.state?"--error":"success"===this.state?"--success":"drag"===this.state&&this.hover?"is-hover":void 0},iconClass:function(){return this.state?"drag"==this.state?"fal fa-arrow-up":"uploading"==this.state?"fal fa-spinner-third fa-spin":"success"==this.state?"fal fa-check":"error"==this.state?"fal fa-exclamation-triangle":void 0:this.myCurrent?null:"fal fa-"+this.icon},infoText:function(){if("uploading"==this.state)return"Uploading ...";if("error"==this.state)return this.errorMessage;if("success"==this.state)return"File successfully uploaded";if("drag"==this.state)return"Drop a file to upload";if(this.myCurrent){var t=this.myCurrent.split("/").reverse()[0],e=t.substring(0,7)+"..."+t.split(".").reverse()[0];return e.length<t.length?e:t}return"Drop here to upload"}},methods:{initDropzone:function(){this._dropzone&&this._dropzone.destroy(),this.url&&(this.original=this.myCurrent,this._dropzone=new n.a("#"+this.id,{url:this.url,params:this.params,previewsContainer:"#"+this.id+"-previews",previewTemplate:"<div></div>",clickable:this.$refs.upload,maxFilesize:this.options.maxSize,acceptedFiles:this.accept,uploadprogress:function(t,e,i){this.state="uploading",this.progress=e}.bind(this),success:function(t,e){this.hover=!1,e.success?(this.prev=this.myCurrent,this.myCurrent=e.url,this.state="success"):(this.state="error",this.errorMessage=e.message||"Error uploading file"),e.message&&$dispatcher.$emit("notification:"+(e.success?"success":"error"),e.message),e.success&&(this.$emit("input",e.url),this.$emit("uploaded",{url:e.url,data:e})),setTimeout(function(){this.setNullState()}.bind(this),3333)}.bind(this),error:function(t,e){this.hover=!1,this.state="error",this.errorMessage="Error uploading file",this.$emit("uploaded",{url:null,data:t})}.bind(this),dragenter:function(t){this.hover=!0,$dispatcher.$emit("pckg-htmlbuilder-dropzone:all:dragenter",this.id)}.bind(this),dragleave:function(t){$(t.target).is($("#"+this.id))&&(this.hover=!1)}.bind(this),init:function(){this.on("drop",(function(t){$dispatcher.$emit("body:dragend",t),$("body").removeClass("has-drag")}))}}))},deleteFile:function(){var t=this.params,e=encodeURIComponent,i=Object.keys(t).map((function(i){return e(i)+"="+e(t[i])})).join("&");this.state="deleting",http.deleteJSON(this.url+(Object.keys(t).length>0?"?"+i:""),function(){this.myCurrent=null,this.state=null,this.$emit("deleted")}.bind(this),function(){this.state="error",this.errorMessage="Error deleting file"}.bind(this))},openSelection:function(){this.errorMessage=null,this.state=null,this._dropzone.hiddenFileInput.click()},setDragState:function(){this.minHeight=$(this.$el).height()+"px",this.state="drag"},setNullState:function(){this.state=null},setNullStateWithHeight:function(){this.minHeight="auto",this.setNullState()},checkAllDragEnter:function(t){this.id!=t&&(this.hover=!1)}},mounted:function(){this.$nextTick(function(){this.initDropzone()}.bind(this))},created:function(){$dispatcher.$on("body:dragenter",this.setDragState),$dispatcher.$on("body:dragleave",this.setNullState),$dispatcher.$on("body:dragend",this.setNullStateWithHeight),$dispatcher.$on("pckg-htmlbuilder-dropzone:all:dragenter",this.checkAllDragEnter)},beforeDestroy:function(){$dispatcher.$off("body:dragenter",this.setDragState),$dispatcher.$off("body:dragleave",this.setNullState),$dispatcher.$off("body:dragend",this.setNullStateWithHeight),$dispatcher.$off("pckg-htmlbuilder-dropzone:all:dragenter",this.checkAllDragEnter)}},o=i(93),l=Object(o.a)(a,s,[],!1,null,null,null);l.options.__file="vendor/pckg/generic/src/Pckg/Maestro/public/vue/pckg-htmlbuilder-dropzone.vue";e.default=l.exports}}]);