(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{135:function(t,e,s){"use strict";(function(t){s(151),s(144),s(163),s(165),s(122),s(179);var i=s(186),r=s.n(i),n=s(190);e.a={name:"pckg-htmlbuilder-dropzone",mixins:[pckgCdn],props:{current:{type:String,default:""},prev:{type:String,default:""},url:{type:String,default:""},params:{type:Object,default:function(){return{}}},id:{type:String,default:function(){return"dropzone-"+Object(n.a)()}},value:{type:String,default:""},accept:{default:null},options:{default:function(){return{maxSize:2}}},icon:{default:"image"},preview:{default:!0}},data:function(){return{original:null,_dropzone:null,_dropzoneHash:null,_makeResolve:null,_makeReject:null,_previewTemplate:null,myCurrent:this.current,state:null,hover:!1,progress:0,myOptions:this.options,minHeight:"auto"}},watch:{current:function(t){this.myCurrent=t},url:function(t,e){this.initDropzone()},params:function(t,e){this.initDropzone()}},computed:{stateClass:function(){return"error"===this.state?"--error":"success"===this.state?"--success":"drag"===this.state&&this.hover?"is-hover":void 0},iconClass:function(){return this.state?"drag"==this.state?"fal fa-arrow-up":"queued"==this.state?"fal fa-upload":"uploading"==this.state?"fal fa-spinner-third fa-spin":"success"==this.state?"fal fa-check":"error"==this.state?"fal fa-exclamation-triangle":void 0:this.myCurrent?null:"fal fa-"+this.icon},infoText:function(){if("queued"==this.state)return"File selected for upload";if("uploading"==this.state)return"Uploading ...";if("error"==this.state)return this.errorMessage;if("success"==this.state)return"File successfully uploaded";if("drag"==this.state)return"Drop a file to upload";if(this.myCurrent){var t=this.myCurrent.split("/").reverse()[0],e=t.substring(0,7)+"..."+t.split(".").reverse()[0];return e.length<t.length?e:t}return"Drop here to upload"}},methods:{isImage:function(t){if(!t)return!1;var e=t.split(".").reverse()[0].toLowerCase();return["png","gif","png","webp","jpg","jpeg"].indexOf(e)>=0},process:function(){var t=this;return new Promise((function(e,s){t._makeResolve=e,t._makeReject=s,t._dropzone.processQueue()}))},dropzoneHash:function(){return JSON.stringify({url:this.url,params:this.params})},initDropzone:function(){var e=this,s=this.dropzoneHash();if(this._dropzoneHash!==s&&(this._dropzoneHash=s,this.state=null,this._dropzone&&this._dropzone.destroy(),this.url)){var i=document.getElementsByName("pckgvdth"),n={};1===i.length&&(n={"X-Pckg-CSRF":i[0].getAttribute("content")}),this.original=this.myCurrent,this.$nextTick((function(){e._dropzone=new r.a("#"+e.id,{url:e.url,params:e.params,headers:n,previewsContainer:"#"+e.id+"-previews",previewTemplate:"<div></div>",clickable:e.$refs.upload,autoProcessQueue:!e.options.manualProcess,maxFilesize:e.options.maxSize,acceptedFiles:e.accept,uploadprogress:function(t,e,s){this.state="uploading",this.progress=e}.bind(e),success:function(t,e){this.hover=!1,e.success?(this.prev=this.myCurrent,this.myCurrent=e.url,this.state="success",this._makeResolve&&this._makeResolve()):(this.state="error",this.errorMessage=e.message||"Error uploading file",this._makeReject&&this._makeReject()),e.message&&$dispatcher.$emit("notification:"+(e.success?"success":"error"),e.message),e.success&&(this.$emit("input",e.url),this.$emit("uploaded",{url:e.url,filename:e.filename||null,data:e})),setTimeout(function(){this.setNullState()}.bind(this),3333)}.bind(e),error:function(t,e){this.hover=!1,this.state="error",this.errorMessage="Error uploading file",this.$emit("uploaded",{url:null,data:t})}.bind(e),dragenter:function(t){this.hover=!0,$dispatcher.$emit("pckg-htmlbuilder-dropzone:all:dragenter",this.id)}.bind(e),dragleave:function(e){t(e.target).is(t("#"+this.id))&&(this.hover=!1)}.bind(e),init:function(){}}),e._dropzone.on("drop",(function(e){$dispatcher.$emit("body:dragend",e),t("body").removeClass("has-drag")})),e._dropzone.on("addedfile",(function(){e.state="queued"})),e._dropzone.on("addedfiles",(function(){e.state="queued"}))}))}},deleteFile:function(){var t=this.params,e=encodeURIComponent,s=Object.keys(t).map((function(s){return e(s)+"="+e(t[s])})).join("&");this.state="deleting",http.deleteJSON(this.url+(Object.keys(t).length>0?"?"+s:""),function(){this.myCurrent=null,this.state=null,this.$emit("deleted")}.bind(this),function(){this.state="error",this.errorMessage="Error deleting file"}.bind(this))},openSelection:function(){this.errorMessage=null,this.state=null,this._dropzone.hiddenFileInput.click()},setDragState:function(){this.minHeight=t(this.$el).height()+"px",this.state="drag"},setNullState:function(){this.state=null},setNullStateWithHeight:function(){this.minHeight="auto",this.setNullState()},checkAllDragEnter:function(t){this.id!=t&&(this.hover=!1)}},mounted:function(){this.$nextTick(function(){this.initDropzone()}.bind(this))},created:function(){$dispatcher.$on("body:dragenter",this.setDragState),$dispatcher.$on("body:dragleave",this.setNullState),$dispatcher.$on("body:dragend",this.setNullStateWithHeight),$dispatcher.$on("pckg-htmlbuilder-dropzone:all:dragenter",this.checkAllDragEnter)},beforeDestroy:function(){$dispatcher.$off("body:dragenter",this.setDragState),$dispatcher.$off("body:dragleave",this.setNullState),$dispatcher.$off("body:dragend",this.setNullStateWithHeight),$dispatcher.$off("pckg-htmlbuilder-dropzone:all:dragenter",this.checkAllDragEnter)}}}).call(this,s(15))},189:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"c-pckg-htmlbuilder-dropzone",class:t.stateClass,attrs:{id:t.id}},[t.iconClass?s("div",{staticClass:"as-table",style:{minHeight:t.minHeight}},[s("div",{staticClass:"s-icon text-center"},[s("i",{staticClass:"__state-icon fa-fw",class:t.iconClass})]),s("div",{staticClass:"s-text"},["uploading"==t.state&&t.progress>0?s("span",{staticClass:"__percentage-progress"},[t._v(t._s(t.progress)+"%")]):t._e(),t._v(" "+t._s(t.infoText)+" ")]),t.state&&-1!=["uploading","drag","success"].indexOf(t.state)?t._e():s("div",{staticClass:"s-action text-right"},[s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openSelection(e)}}},[t._v("Upload new")])])]):t.myCurrent?s("div",{staticClass:"as-table",style:{minHeight:t.minHeight}},[t.preview&&!t.iconClass&&t.isImage(t.myCurrent)?s("div",{staticClass:"s-img"},[s("a",{directives:[{name:"popup-image",rawName:"v-popup-image"}],staticClass:"__img-link",attrs:{href:t.cdn(t.myCurrent)}},[s("img",{staticClass:"__img",attrs:{src:t.cdn(t.myCurrent)}})])]):s("div",{staticClass:"s-icon text-center"},[s("i",{staticClass:"__state-icon fal fa-fw fa-file"})]),s("div",{staticClass:"s-text"},[t._v(" "+t._s(t.infoText)+" ")]),s("div",{staticClass:"s-action text-left"},[s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openSelection(e)}}},[t._v("Re-upload")]),t._v(" "),s("br"),s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.deleteFile(e)}}},[t._v("Delete")])])]):t._e(),s("div",{ref:"upload",staticClass:"hidden",attrs:{type:"file"}}),s("div",{staticClass:"hidden",attrs:{id:t.id+"-previews"}})])};i._withStripped=!0;var r=s(135).a,n=s(143),a=Object(n.a)(r,i,[],!1,null,null,null);a.options.__file="vendor/pckg/helpers-js/vue/pckg-htmlbuilder-dropzone.vue";e.default=a.exports}}]);